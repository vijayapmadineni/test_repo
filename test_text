import os
from smbprotocol import smbclient
from smbprotocol import transport

# FSx Configuration
domain = "YOUR_DOMAIN"           # Replace with your domain
username = "YOUR_USERNAME"       # Replace with your username
password = "YOUR_PASSWORD"       # Replace with your password
fsx_ip = "10.152.10.123"         # FSx IP
share_name = "share_1"           # Share name
folder_name = "test_folder"      # Folder to list files from

# Setup SMBProtocol (requires domain, username, and password)
smbclient.ClientConfig(username=username, password=password, domain=domain)
smbclient.register_session(fsx_ip, username=username, password=password)

def list_files_in_share():
    try:
        # Build the UNC path to the folder
        share_path = f"\\\\{fsx_ip}\\{share_name}\\{folder_name}"

        # List files in the folder
        files = smbclient.listdir(share_path)
        print(f"Files in {folder_name}: {files}")
        return files
    except Exception as e:
        print(f"Error listing files: {e}")
        raise

# Main execution
if __name__ == "__main__":
    list_files_in_share()
